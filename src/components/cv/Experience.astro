---
import type { Experience } from '@/data/cv'
import type { Lang } from '@/data/i18n'
import { t } from '@/data/i18n'

interface Props {
  experiences: Experience[]
  lang?: Lang
}

const { experiences, lang = 'es' } = Astro.props

const months: Record<Lang, string[]> = {
  es: ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'],
  en: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
  ca: ['gen', 'feb', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'oct', 'nov', 'des'],
  gl: ['xan', 'feb', 'mar', 'abr', 'mai', 'xuñ', 'xul', 'ago', 'set', 'out', 'nov', 'dec']
}

function formatDate(dateStr: string | null): string {
  if (!dateStr) return t(lang, 'cv.current')
  const [year, month] = dateStr.split('-')
  if (month) {
    return `${months[lang][parseInt(month) - 1]} ${year}`
  }
  return year
}
---

<section class="print-section mb-8">
  <h3 class="print-title text-sm font-semibold text-[--color-accent-violet] print:text-black mb-4 uppercase tracking-wider font-mono">
    {t(lang, 'section.experience')}
  </h3>

  <div class="space-y-5">
    {experiences.map(exp => (
      <article class="border-l-2 border-[--color-border-highlight] print:border-gray-300 pl-3">
        <!-- Header: Position @ Company | Date -->
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline gap-1 mb-1">
          <div>
            <span class="font-semibold text-[--color-text-bright] print:text-black font-sans">{exp.position}</span>
            <span class="text-[--color-text-muted] print:text-gray-500"> @ </span>
            <a href={exp.url} target="_blank" rel="noopener noreferrer" class="text-[--color-accent-primary] print:text-gray-700 hover:underline font-sans">
              {exp.name}
            </a>
          </div>
          <span class="text-xs text-[--color-text-muted] print:text-gray-500 font-mono shrink-0">
            {formatDate(exp.startDate)} — {formatDate(exp.endDate)}
          </span>
        </div>

        <!-- Summary -->
        <p class="text-sm text-[--color-text-muted] print:text-gray-600 mb-2 font-sans">
          {exp.summary}
        </p>

        <!-- Highlights -->
        {exp.highlights && exp.highlights.length > 0 && (
          <ul class="space-y-1.5 mb-2">
            {exp.highlights.map(highlight => (
              <li class="text-sm text-[--color-text] print:text-gray-800 flex items-start gap-2 font-sans">
                <span class="text-[--color-accent-purple] print:text-gray-400 shrink-0" aria-hidden="true">›</span>
                <span>{highlight}</span>
              </li>
            ))}
          </ul>
        )}

        <!-- Tech Stack - inline -->
        {exp.technologies && exp.technologies.length > 0 && (
          <p class="text-xs text-[--color-text-muted] print:text-gray-500 font-mono">
            {exp.technologies.join(' · ')}
          </p>
        )}
      </article>
    ))}
  </div>
</section>
